{% extends '::PrincipalBase.html.twig' %}

{% block principal -%}

<a href="#help" class="btn pull-right tool" data-toggle="modal" title="Click para ayuda"><i class="icon-question-sign"></i></a>
{{ include('EvaluacionBundle:Ayuda/Formulario:Registrar.html.twig')}}

    <h4 class="text-center">REGISTRO DE NUEVO FORMULARIO DE EVALUACI&Oacute;N</h4>

    <form action="{{ path('formularioevaluacion_create') }}" method="post" {{ form_enctype(form) }}>
       <br>

<p><b>Informaci&oacute;n del formulario de evaluación: </b></p>
<br>
        <table class="table table-bordered form-inline">
            <tr>
                <th width="30%">{{form_label(form.tipoformulario)}}</th><td>{{form_widget(form.tipoformulario)}} {{form_errors(form.tipoformulario)}}</td>
            </tr>
            <tr>
                <th>{{form_label(form.codigoformulario)}}</th><td>{{form_widget(form.codigoformulario)}} {{form_errors(form.codigoformulario)}}</td>
            </tr>
            <tr>
                <th>{{form_label(form.nombrebreve)}}</th><td>{{form_widget(form.nombrebreve)}} {{form_errors(form.nombrebreve)}}</td>
            </tr>
        </table>

        <br>
        <p><b>Factores de evaluación: </b></p>
        <br>
        <table class="table table-bordered form-inline">
            <tr>
                <th width="30%">{{form_label(form.Factores[0].nombrefactor)}}</th><td>{{form_widget(form.Factores[0].nombrefactor)}} {{form_errors(form.Factores[0].nombrefactor)}}</td>
            </tr>
            <tr>
                <th>{{form_label(form.Factores[0].descripcionfactor)}}</th><td>{{form_widget(form.Factores[0].descripcionfactor)}} {{form_errors(form.Factores[0].descripcionfactor)}}</td>
            </tr>
        </table>

        <ul class="Factores unstyled" data-prototype-fac ="
            <table class='table table-bordered form-inline'>
                <tr>
                    <th width='30%''>{{form_label(form.Factores.vars.prototype.nombrefactor)|e}}</th>
                    <td>{{form_widget(form.Factores.vars.prototype.nombrefactor)|e}} {{form_errors(form.Factores.vars.prototype.nombrefactor)|e}}</td>
                </tr>
                <tr>
                    <th>{{form_label(form.Factores.vars.prototype.descripcionfactor)|e}}</th>
                    <td>{{form_widget(form.Factores.vars.prototype.descripcionfactor)|e}} {{form_errors(form.Factores.vars.prototype.descripcionfactor)|e}}</td>
                </tr>
            </table>
               
               ">
               
               <div class='Opciones unstyled' data-prototype-opc ='
                <table class="table table-bordered form-inline">
                    <tr>
                        <th>{{form_label(form.Factores.vars.prototype.children['Opciones'].vars.prototype.nombreopcion)|e}}</th>
                        <td>{{form_widget(form.Factores.vars.prototype.children['Opciones'].vars.prototype.nombreopcion)|e}}</td>
                    </tr>
                    <tr>
                        <th>{{form_label(form.Factores.vars.prototype.children['Opciones'].vars.prototype.descripcionopcion)|e}} </th>
                        <td>{{form_widget(form.Factores.vars.prototype.children['Opciones'].vars.prototype.descripcionopcion)|e}} </td>
                    </tr>
                    <tr>
                        <th>{{form_label(form.Factores.vars.prototype.children['Opciones'].vars.prototype.valoropcion)|e}}</th>
                        <td>{{form_widget(form.Factores.vars.prototype.children['Opciones'].vars.prototype.valoropcion)|e}}</td>
                    </tr>
                </table>
               '
               ></div>
               <table class='table table-bordered form-inline'>
                    <tr>
                        <th>{{form_label(form.Factores[0].Opciones[0].nombreopcion)}}</th>
                        <td>{{form_widget(form.Factores[0].Opciones[0].nombreopcion)}}</td>
                    </tr>
                    <tr>
                        <th>{{form_label(form.Factores[0].Opciones[0].descripcionopcion)}} </th>
                        <td>{{form_widget(form.Factores[0].Opciones[0].descripcionopcion)}} </td>
                    </tr>
                    <tr>
                        <th>{{form_label(form.Factores[0].Opciones[0].valoropcion)}}</th>
                        <td>{{form_widget(form.Factores[0].Opciones[0].valoropcion)}}</td>
                    </tr>
                </table>

                
           </ul>


    <div class="hide">
        {{ form_rest(form) }}
    </div>
        
        <div class="text-center">
            <button type="submit" class="btn btn-primary">Registrar</button>
            <button type="button" class="btn">Cancelar</button>
        </div>
    </form>



<script>

/*********************************** FACTORES ****************************************/
// Obtiene la ul que contiene la colección de etiquetas
var collectionHolderFac = $('ul.Factores');

// configura una enlace "Agregar una etiqueta"
var $addTagLinkFac = $('<input type="button" value="Agregar Factor" class="btn">');
var $newLinkLiFac = $('<ul></ul>').append($addTagLinkFac);

jQuery(document).ready(function() {
    // Añade el ancla "Agregar una etiqueta" y las etiquetas li y ul
    collectionHolderFac.append($newLinkLiFac);

    // Añade un enlace para eliminar todas las etiquetas existentes
    // en elementos li del formulario
    collectionHolderFac.find('li').each(function() {
        addTagFormDeleteLink($(this));
    });

    // cuenta las entradas actuales en el formulario (p. ej. 2),
    // la usa como índice al insertar un nuevo elemento (p. ej. 2)
    collectionHolderFac.data('index', collectionHolderFac.find(':input').length);

    $addTagLinkFac.on('click', function(e) {
        // evita crear el enlace con una "#" en la URL
        e.preventDefault();

        // añade una nueva etiqueta form (ve el siguiente bloque de código)
        addTagForm2(collectionHolderFac, $newLinkLiFac);
    });
 });

/******************************* OPciones *************************/
var collectionHolderOpc = $('div.Opciones');

// configura una enlace "Agregar una etiqueta"
var $addTagLinkOpc = $('<input type="button" value="Agregar Opcion" class="btn">');
var $newLinkLiOpc = $('<ul></ul>').append($addTagLinkOpc);

jQuery(document).ready(function() {
    // Añade el ancla "Agregar una etiqueta" y las etiquetas li y ul
    collectionHolderOpc.append($newLinkLiOpc);

    // Añade un enlace para eliminar todas las etiquetas existentes
    // en elementos li del formulario
    collectionHolderOpc.find('li').each(function() {
        addTagFormDeleteLink($(this));
    });

    // cuenta las entradas actuales en el formulario (p. ej. 2),
    // la usa como índice al insertar un nuevo elemento (p. ej. 2)
    collectionHolderOpc.data('index', collectionHolderOpc.find(':input').length);

    $addTagLinkOpc.on('click', function(e) {
        // evita crear el enlace con una "#" en la URL
        e.preventDefault();

        // añade una nueva etiqueta form (ve el siguiente bloque de código)
        addTagForm3(collectionHolderOpc, $newLinkLiOpc);
    });
 });


/****** Funciones predefinidas Formularios embebidos ************/
function addTagForm2(collectionHolder, $newLinkLi) {
    // Obtiene los datos del prototipo explicado anteriormente
    var prototype = collectionHolder.data('prototype-fac');

    // Consigue el nuevo índice
    var index = collectionHolder.data('index');

    // Sustituye el '__name__' en el prototipo HTML para que
    // en su lugar sea un número basado en cuántos elementos hay
    var newForm = prototype.replace(/__name__/g, index);

    // Incrementa en uno el índice para el siguiente elemento
    collectionHolder.data('index', index + 1);

    // Muestra el formulario en la página en un elemento li,
    // antes del enlace 'Agregar una etiqueta'
    var $newFormLi = $('<li></li>').append(newForm);
    $newLinkLi.before($newFormLi);

     // Añade un enlace eliminar el nuevo formulario
    addTagFormDeleteLink($newFormLi);
}


/****** Funciones predefinidas Formularios embebidos //OPCIONES ************/
function addTagForm3(collectionHolder, $newLinkLi) {
    // Obtiene los datos del prototipo explicado anteriormente
    var prototype = collectionHolder.data('prototype-opc');

    // Consigue el nuevo índice
    var index = collectionHolder.data('index');

    // Sustituye el '__name__' en el prototipo HTML para que
    // en su lugar sea un número basado en cuántos elementos hay
    var newForm = prototype.replace(/__name__/g, index);

    // Incrementa en uno el índice para el siguiente elemento
    collectionHolder.data('index', index + 1);

    // Muestra el formulario en la página en un elemento li,
    // antes del enlace 'Agregar una etiqueta'
    var $newFormLi = $('<li></li>').append(newForm);
    $newLinkLi.before($newFormLi);

     // Añade un enlace eliminar el nuevo formulario
    addTagFormDeleteLink($newFormLi);
}



</script>

{% endblock %}
